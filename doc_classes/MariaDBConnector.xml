<?xml version="1.0" encoding="UTF-8" ?>
<class name="MariaDBConnector" inherits="RefCounted" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/godotengine/godot/master/doc/class.xsd">
	<brief_description>
		Allows connection to a MariaDB server and running queries from GDScript.
	</brief_description>
	<description>
		MariaDBConnector enables you to connect to a MariaDB server using a TCP connection. You can send SQL queries, receive results, and manage the connection state directly from GDScript.
	</description>
	<tutorials>
	</tutorials>
	<methods>
		<method name="connect_db">
			<return type="int" enum="MariaDBConnector.ErrorCode" />
			<param index="0" name="hostname" type="String" />
			<param index="1" name="port" type="int" />
			<param index="2" name="database" type="String" />
			<param index="3" name="username" type="String" />
			<param index="4" name="password" type="String" />
			<param index="5" name="authtype" type="int" enum="MariaDBConnector.AuthType" default="0" />
			<param index="6" name="is_prehashed" type="bool" default="true" />
			<description>
				Establishes a connection to the MariaDB server using the provided host, port, database name, username, and password.
				[codeblock]
				If is_prehashed = true then
				    If authtype = AUTH_TYPE_MYSQL_NATIVE, the password string must be sha1 hex hash of the plain password.
				    If authtype = AUTH_TYPE_ED25519, the password string must be sha512 hex hash of the plain password.
				[/codeblock]
				[codeblock lang=gdscript]
				var err: MariaDBConnector.ErrorCode = db.connect_db(
				    "localhost",
				    3306,
				    "some_db_name",
				    "some_username",
				    "sha512_encrypted_password_to_hex_string",
				    MariaDBConnector.AUTH_TYPE_ED25519,
				    true)

				if err != MariaDBConnector.ErrorCode.OK:
				    push_error(err)
				    return
				[/codeblock]
			</description>
		</method>
		<method name="connect_db_ctx">
			<return type="int" enum="MariaDBConnector.ErrorCode" />
			<param index="0" name="mariadb_connect_context" type="MariaDBConnectContext" />
			<description>
				Establishes a connection to the MariaDB server using a context.
				[codeblock lang=gdscript]
				var ctx := MariaDBConnectContext.new()
				# Using defaults for unlisted members.
				ctx.db_name = "some_db"
				ctx.username = "some_db_user"
				ctx.password = "db_users_password_sha512_base64_hashed_encoded"

				var db :=  MariaDBConnector.new()
				var err: MariaDBConnector.ErrorCode = db.connect_db_ctx(ctx)
				if err != MariaDBConnector.ErrorCode.OK:
				    push_error(err)
				    return
				[/codeblock]
			</description>
		</method>
		<method name="connection_instance" qualifiers="static">
			<return type="MariaDBConnector" />
			<param index="0" name="mariadb_connect_context" type="MariaDBConnectContext" />
			<description>
				Static member that returns a connected MariaDBConnector instance or null.
				[codeblock lang=gdscript]
				var ctx := MariaDBConnectContext.new()
				# Using defaults for unlisted members.
				ctx.db_name = "some_db"
				ctx.username = "some_db_user"
				ctx.password = "db_users_password_sha512_hashed_base64_encoded"

				var db := MariaDBConnector.connection_instance(ctx)
				if db == null:
				    # Error is already printed by the addon.
				    return
				[/codeblock]
			</description>
		</method>
		<method name="disconnect_db">
			<return type="void" />
			<description>
				Disconnects from the current database session.
			</description>
		</method>
		<method name="execute_command">
			<return type="Dictionary" />
			<param index="0" name="sql_stmt" type="String" />
			<description>
				Returns a [Dictionary] with the affected_rows, last_insert_id, status_flags, warnings, and info for all 
					none SELECT command types like INSERT, UPDATE, DELETE, BEGIN, COMMIT and ROLLBACK.
				[codeblock lang=gdscript]
				var stmt: String = "INSERT INTO table_name (val) VALUES (1234);"
				var res: Dictionary = db.execute_command(stmt)
				if db.last_error != MariaDBConnector.ErrorCode.OK:
				    printerr("Error %d on INSERT" % [db.last_error]) 
				else:
				    print("rows affected:", res["affected_rows"])
				    print("Last Inserted ID:", res["last_insert_id"])
				[/codeblock]
			</description>
		</method>
		<method name="get_last_error" qualifiers="const">
			<return type="int" enum="MariaDBConnector.ErrorCode" />
			<description>
				Getter for last_error, use to check for OK or ErrorCode on last funtion.
			</description>
		</method>
		<method name="get_last_query_converted">
			<return type="PackedByteArray" />
			<description>
				Returns the converted form of the last query, suitable for debugging or re-sending.
			</description>
		</method>
		<method name="get_last_response">
			<return type="PackedByteArray" />
			<description>
				Returns the raw response buffer from the last server response.
			</description>
		</method>
		<method name="get_last_transmitted">
			<return type="PackedByteArray" />
			<description>
				Returns the last transmitted packet buffer sent to the server.
			</description>
		</method>
		<method name="query">
			<return type="Variant" />
			<param index="0" name="sql_stmt" type="String" />
			<description>
				Executes the given SQL statement against the connected database. The result of the query could be ErrorCode or [Array][[Dictionary]], for SELECT only, depending on the statement.
			</description>
		</method>
		<method name="select_query">
			<return type="Dictionary[]" />
			<param index="0" name="sql_stmt" type="String" />
			<description>
				Strict typed return of [Array][[Dictionary]] instead of Variant, use last_error to check for error.
				[codeblock lang=gdscript]
				var stmt: String = "SELECT * FROM table_name;"
				var rows: Array[Dictionary] = db.select_query(stmt)
				if db.last_error == MariaDBConnector.ErrorCode.OK:
				   for row:Dictionary in rows:
				       print("row:", row)
				else:
				   printerr("Error %d on sSELECT" % [db.last_error])
				[/codeblock]
			</description>
		</method>
		<method name="set_db_name">
			<return type="void" />
			<param index="0" name="db_name" type="String" />
			<description>
				Sets or changes the database name to use for subsequent queries, use if databsae needs to be changed on an established connection.
			</description>
		</method>
		<method name="set_dbl_to_string">
			<return type="void" />
			<param index="0" name="is_to_str" type="bool" />
			<description>
				If true, floating-point values will be returned as [String] to preserve precision.
			</description>
		</method>
		<method name="set_ip_type">
			<return type="void" />
			<param index="0" name="type" type="int" enum="MariaDBConnector.IpType" />
			<description>
				Change the IpType for DNS and connections, some networks may require IPV4 or IPV6 specifically.
			</description>
		</method>
		<method name="set_server_timeout">
			<return type="void" />
			<param index="0" name="msec" type="int" default="1000" />
			<description>
				Change the error delay to receive data from the MariaDB server. There are several checks to ensure the buffer size matches packet length codes, this delay can be cumulative for each packet length code sent from the MariaDB server, use with caution.
			</description>
		</method>
	</methods>
	<members>
		<member name="is_connected_db" type="bool" setter="" getter="is_connected_db" default="false">
			True if client is still conneced to the MariaDB server, this is not 100%, someimtes, when timeout occurs (about ~20min), MariaiDB will drop a connection without closing the socket.
		</member>
		<member name="last_error" type="int" setter="" getter="get_last_error_code" enum="MariaDBConnector.ErrorCode" default="0">
			Holds the ErrorCode of the last function and updated on every function call.
		</member>
	</members>
	<constants>
		<constant name="IP_TYPE_IPV4" value="1" enum="IpType">
		</constant>
		<constant name="IP_TYPE_IPV6" value="2" enum="IpType">
		</constant>
		<constant name="IP_TYPE_ANY" value="3" enum="IpType">
		</constant>
		<constant name="AUTH_TYPE_ED25519" value="0" enum="AuthType">
		</constant>
		<constant name="AUTH_TYPE_MYSQL_NATIVE" value="1" enum="AuthType">
		</constant>
		<constant name="OK" value="0" enum="ErrorCode">
		</constant>
		<constant name="ERR_NO_RESPONSE" value="1" enum="ErrorCode">
		</constant>
		<constant name="ERR_NOT_CONNECTED" value="2" enum="ErrorCode">
		</constant>
		<constant name="ERR_PACKET_LENGTH_MISMATCH" value="3" enum="ErrorCode">
		</constant>
		<constant name="ERR_SERVER_PROTOCOL_INCOMPATIBLE" value="4" enum="ErrorCode">
		</constant>
		<constant name="ERR_CLIENT_PROTOCOL_INCOMPATIBLE" value="5" enum="ErrorCode">
		</constant>
		<constant name="ERR_SEQUENCE_MISMATCH" value="6" enum="ErrorCode">
		</constant>
		<constant name="ERR_AUTH_PLUGIN_NOT_SET" value="7" enum="ErrorCode">
		</constant>
		<constant name="ERR_AUTH_PLUGIN_INCOMPATIBLE" value="8" enum="ErrorCode">
		</constant>
		<constant name="ERR_AUTH_FAILED" value="9" enum="ErrorCode">
		</constant>
		<constant name="ERR_USERNAME_EMPTY" value="10" enum="ErrorCode">
		</constant>
		<constant name="ERR_PASSWORD_EMPTY" value="11" enum="ErrorCode">
		</constant>
		<constant name="ERR_DB_NAME_EMPTY" value="12" enum="ErrorCode">
		</constant>
		<constant name="ERR_PASSWORD_HASH_LENGTH" value="13" enum="ErrorCode">
		</constant>
		<constant name="ERR_INVALID_HOSTNAME" value="14" enum="ErrorCode">
		</constant>
		<constant name="ERR_CONNECTION_ERROR" value="15" enum="ErrorCode">
		</constant>
		<constant name="ERR_INIT_ERROR" value="16" enum="ErrorCode">
		</constant>
		<constant name="ERR_UNAVAILABLE" value="17" enum="ErrorCode">
		</constant>
		<constant name="ERR_PROTOCOL_MISMATCH" value="18" enum="ErrorCode">
		</constant>
		<constant name="ERR_AUTH_PROTOCOL_MISMATCH" value="19" enum="ErrorCode">
		</constant>
		<constant name="ERR_SEND_FAILED" value="20" enum="ErrorCode">
		</constant>
		<constant name="ERR_INVALID_PORT" value="21" enum="ErrorCode">
		</constant>
		<constant name="ERR_UNKNOWN" value="22" enum="ErrorCode">
		</constant>
		<constant name="ERR_PACKET" value="23" enum="ErrorCode">
		</constant>
	</constants>
</class>
